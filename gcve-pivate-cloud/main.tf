# Custom VPC
data "google_compute_network" "custom_vpc" {
  name    = var.custom_vpc_name
  project = var.project_id
}

# VEN 
resource "google_vmwareengine_network" "vmware_engine_network" {
  #provider    = google-beta
  project  = var.project_id
  name     = "gcve-poc-ven"
  location = "global"
  type     = "STANDARD"
}

# Peering network
resource "google_vmwareengine_network_peering" "vmw-engine-network-peering" {

  name                  = "gcve-peer-ven-vpc"
  project               = var.project_id
  vmware_engine_network = google_vmwareengine_network.vmware_engine_network.id
  peer_network          = data.google_compute_network.custom_vpc.id
  peer_network_type     = "STANDARD"
  export_custom_routes  = true
  import_custom_routes  = true
}

# GCVE Private Cloud
resource "google_vmwareengine_private_cloud" "vmw_private_cloud" {
  location = var.default_zone
  name     = "gcve-priv-cloud"
  type     = "TIME_LIMITED"

  network_config {
    management_cidr       = "10.20.0.0/24"
    vmware_engine_network = google_vmwareengine_network.vmware_engine_network.id
  }

  project = var.project_id

  management_cluster {
    cluster_id = "gcve-vmw-poc-cluster"
    node_type_configs {
      node_type_id      = "standard-72"
      node_count        = 1
      custom_core_count = 32
    }
  }

  timeouts {
    create = "6h"
    delete = "6h"
  }
}